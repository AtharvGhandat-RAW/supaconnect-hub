# Attendro Security Model & Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   ATTENDRO SECURITY ARCHITECTURE                                    â”‚
â”‚                      Multi-Layer Security: Device + Token + Batch Lock                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              LAYER 1: AUTHENTICATION (Faculty/Teacher)                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                                     â•‘
â•‘   STEP 1: Faculty App Login                                                                        â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                           â•‘
â•‘                                                                                                     â•‘
â•‘   Teacher opens Faculty App                                                                        â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                â•‘
â•‘   â”‚  Email: teacher@college.edu  â”‚                                                                â•‘
â•‘   â”‚  Password: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢      â”‚                                                                â•‘
â•‘   â”‚  [Login Button]              â”‚                                                                â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   Supabase Auth.signInWithPassword()                                                               â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â•‘
â•‘   â”‚  Verify credentials against auth.users   â”‚                                                    â•‘
â•‘   â”‚  Check faculty role permission           â”‚                                                    â•‘
â•‘   â”‚  Generate JWT session token (expires)    â”‚                                                    â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   JWT Token Structure:                                                                             â•‘
â•‘   {                                                                                                â•‘
â•‘     "sub": "user-uuid",                   // User ID                                               â•‘
â•‘     "email": "teacher@college.edu",       // Email                                                 â•‘
â•‘     "role": "FACULTY",                    // Role claim                                            â•‘
â•‘     "iat": 1705080000,                    // Issued at                                             â•‘
â•‘     "exp": 1705166400                     // Expires in 24 hours                                   â•‘
â•‘   }                                                                                                â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   [Stored in secure storage on device]                                                            â•‘
â•‘   Used for all subsequent API calls (Authorization: Bearer <JWT>)                                  â•‘
â•‘                                                                                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      LAYER 2: SESSION TOKEN GENERATION (Server-Side)                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                                     â•‘
â•‘   STEP 2: Teacher Initiates Lecture Session                                                        â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â•‘
â•‘                                                                                                     â•‘
â•‘   Faculty App POST /api/create-session                                                             â•‘
â•‘   {                                                                                                â•‘
â•‘     "device_id": "D001",                                                                          â•‘
â•‘     "subject_id": "uuid-xxxxx",                                                                    â•‘
â•‘     "class_id": "uuid-yyyyy",                                                                      â•‘
â•‘     "batch": "A",                                                                                  â•‘
â•‘     "lecture_type": "THEORY",                                                                      â•‘
â•‘     "duration_minutes": 50                                                                         â•‘
â•‘   }                                                                                                â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â•‘
â•‘   â”‚  Supabase Edge Function: create-session                â”‚                                     â•‘
â•‘   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                                     â•‘
â•‘   â”‚  1. Verify JWT token                                   â”‚                                     â•‘
â•‘   â”‚  2. Verify faculty owns this class/subject             â”‚                                     â•‘
â•‘   â”‚  3. Verify device exists & is active                   â”‚                                     â•‘
â•‘   â”‚  4. Generate session_token (JWT format)                â”‚                                     â•‘
â•‘   â”‚  5. Query students by class_id + batch                 â”‚                                     â•‘
â•‘   â”‚  6. Extract roll_no from matched students              â”‚                                     â•‘
â•‘   â”‚  7. Store session in DB                                â”‚                                     â•‘
â•‘   â”‚  8. Return token + metadata                            â”‚                                     â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   Session Token (JWT Payload):                                                                     â•‘
â•‘   {                                                                                                â•‘
â•‘     "session_id": "uuid-session",                                                                 â•‘
â•‘     "device_id": "D001",                                                                          â•‘
â•‘     "faculty_id": "uuid-fac",                                                                      â•‘
â•‘     "subject": "Data Structures",                                                                  â•‘
â•‘     "batch": "A",                                                                                  â•‘
â•‘     "class": "SEM-4-DIV-A",                                                                        â•‘
â•‘     "allowed_rolls": [1, 2, 3, ..., 60],  // Only Batch A students                                â•‘
â•‘     "iat": 1705080000,                                                                             â•‘
â•‘     "exp": 1705083000  // Expires after duration                                                  â•‘
â•‘   }                                                                                                â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â•‘
â•‘   â”‚  Insert biometric_sessions row                 â”‚                                              â•‘
â•‘   â”‚  â€¢ session_token                               â”‚                                              â•‘
â•‘   â”‚  â€¢ status = 'ACTIVE'                           â”‚                                              â•‘
â•‘   â”‚  â€¢ start_time, end_time                        â”‚                                              â•‘
â•‘   â”‚  â€¢ device_id, faculty_id, subject_id, class_id â”‚                                              â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   Return to Faculty App:                                                                           â•‘
â•‘   {                                                                                                â•‘
â•‘     "success": true,                                                                               â•‘
â•‘     "session_token": "eyJhbG...",                                                                  â•‘
â•‘     "device_id": "D001",                                                                          â•‘
â•‘     "message": "Session started successfully"                                                     â•‘
â•‘   }                                                                                                â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   [Send to ESP32 Device via WebSocket/HTTP]                                                       â•‘
â•‘                                                                                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    LAYER 3: DEVICE-SIDE VALIDATION (ESP32)                                         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                                     â•‘
â•‘   STEP 3: Fingerprint Scan & Validation (No Internet)                                              â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â•‘
â•‘                                                                                                     â•‘
â•‘   Student places finger on R307 sensor                                                             â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   ESP32 Validation Checklist:                                                                      â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â•‘
â•‘   â”‚ 1. Is session still ACTIVE?                               â”‚                                  â•‘
â•‘   â”‚    â””â”€ Check: current_time < session.end_time              â”‚                                  â•‘
â•‘   â”‚    â””â”€ If NO â†’ "Session Expired"                           â”‚                                  â•‘
â•‘   â”‚                                                             â”‚                                  â•‘
â•‘   â”‚ 2. Is session_token valid?                                â”‚                                  â•‘
â•‘   â”‚    â””â”€ Check: verify_jwt(token) in memory                  â”‚                                  â•‘
â•‘   â”‚    â””â”€ If NO â†’ "Invalid Token - Contact Faculty"           â”‚                                  â•‘
â•‘   â”‚                                                             â”‚                                  â•‘
â•‘   â”‚ 3. Is fingerID in allowed_rolls?                          â”‚                                  â•‘
â•‘   â”‚    â””â”€ Check: fingerID in cached_allowed_list              â”‚                                  â•‘
â•‘   â”‚    â””â”€ If NO â†’ "Not Allowed - Wrong Class/Batch"           â”‚                                  â•‘
â•‘   â”‚                                                             â”‚                                  â•‘
â•‘   â”‚ 4. Has student already marked attendance?                 â”‚                                  â•‘
â•‘   â”‚    â””â”€ Check: local_memory.scanned_rolls[fingerID] exist   â”‚                                  â•‘
â•‘   â”‚    â””â”€ If YES â†’ "Already Marked"                           â”‚                                  â•‘
â•‘   â”‚                                                             â”‚                                  â•‘
â•‘   â”‚ 5. Match fingerprint quality?                             â”‚                                  â•‘
â•‘   â”‚    â””â”€ Check: match_score >= 60                            â”‚                                  â•‘
â•‘   â”‚    â””â”€ If NO â†’ "Fingerprint Poor Quality - Retry"          â”‚                                  â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   IF ALL VALIDATIONS PASS:                                                                        â•‘
â•‘   {                                                                                                â•‘
â•‘     "roll_no": 37,                                                                                â•‘
â•‘     "fingerprint_id": 37,                                                                         â•‘
â•‘     "status": "PRESENT",                                                                          â•‘
â•‘     "timestamp": 1705080634,                                                                      â•‘
â•‘     "verification_score": 95,                                                                     â•‘
â•‘     "device_id": "D001",                                                                          â•‘
â•‘     "session_id": "uuid-session"                                                                  â•‘
â•‘   }                                                                                                â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   [IF ONLINE] POST to /api/mark-attendance                                                        â•‘
â•‘   [IF OFFLINE] Store in local SPIFFS memory queue                                                 â•‘
â•‘                                                                                                     â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   Mark in local in-memory set: scanned_rolls.add(37)                                               â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   Display: "âœ“ Roll 37 PRESENT"                                                                    â•‘
â•‘                                                                                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    LAYER 4: BACKEND VERIFICATION (Sync Time)                                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                                                     â•‘
â•‘   STEP 4: Verify Attendance Records on Backend                                                     â•‘
â•‘   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â•‘
â•‘                                                                                                     â•‘
â•‘   ESP32 POST /api/sync-attendance (with offline records)                                           â•‘
â•‘   {                                                                                                â•‘
â•‘     "session_token": "eyJhbG...",                                                                  â•‘
â•‘     "device_id": "D001",                                                                          â•‘
â•‘     "records": [                                                                                   â•‘
â•‘       { "roll_no": 37, "timestamp": 1705080634, "score": 95 },                                    â•‘
â•‘       { "roll_no": 15, "timestamp": 1705080645, "score": 92 },                                    â•‘
â•‘       ...                                                                                          â•‘
â•‘     ]                                                                                              â•‘
â•‘   }                                                                                                â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â•‘
â•‘   â”‚  Supabase Edge Function: sync-attendance                  â”‚                                   â•‘
â•‘   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                                   â•‘
â•‘   â”‚  1. Verify session_token (JWT decode & check expiry)      â”‚                                   â•‘
â•‘   â”‚  2. Verify device_id matches token.device_id              â”‚                                   â•‘
â•‘   â”‚  3. Verify session still exists in DB                     â”‚                                   â•‘
â•‘   â”‚  4. For each record:                                       â”‚                                   â•‘
â•‘   â”‚     â”œâ”€ Verify roll_no exists in students table            â”‚                                   â•‘
â•‘   â”‚     â”œâ”€ Verify roll_no in session.allowed_rolls            â”‚                                   â•‘
â•‘   â”‚     â”œâ”€ Verify timestamp within session window             â”‚                                   â•‘
â•‘   â”‚     â”œâ”€ Check for duplicates                               â”‚                                   â•‘
â•‘   â”‚     â”œâ”€ Insert into biometric_records                      â”‚                                   â•‘
â•‘   â”‚  5. Update sync_status to 'SYNCED'                        â”‚                                   â•‘
â•‘   â”‚  6. Return success count                                   â”‚                                   â•‘
â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â•‘
â•‘         â”‚                                                                                          â•‘
â•‘         â–¼                                                                                          â•‘
â•‘   Return:                                                                                          â•‘
â•‘   {                                                                                                â•‘
â•‘     "success": true,                                                                               â•‘
â•‘     "synced_count": 15,                                                                            â•‘
â•‘     "failed_count": 0,                                                                             â•‘
â•‘     "message": "All records synced successfully"                                                   â•‘
â•‘   }                                                                                                â•‘
â•‘                                                                                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            SECURITY FEATURES & THREAT MITIGATION                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                      â”‚
â”‚  ğŸ” THREAT 1: Proxy Attendance (Student A marking for Student B)                                   â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚     SOLUTION: Fingerprint biometric matching                                                       â”‚
â”‚     â€¢ R307 sensor performs live fingerprint capture                                                â”‚
â”‚     â€¢ 1:1 match against enrolled fingerprint template                                              â”‚
â”‚     â€¢ False Rejection Rate (FRR) < 0.1%, False Accept Rate (FAR) < 0.001%                         â”‚
â”‚     â€¢ Makes proxy virtually impossible                                                             â”‚
â”‚                                                                                                      â”‚
â”‚  ğŸ” THREAT 2: Wrong Student in Wrong Class/Batch                                                  â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚     SOLUTION: allowed_rolls[] batch lock                                                           â”‚
â”‚     â€¢ Server generates allowed_rolls[1-60] for Batch A                                             â”‚
â”‚     â€¢ Student 61 (Batch B) fingerprint scan returns ID 61                                          â”‚
â”‚     â€¢ Device checks: 61 NOT IN [1-60] â†’ REJECT                                                    â”‚
â”‚     â€¢ Batch-level isolation guaranteed                                                             â”‚
â”‚                                                                                                      â”‚
â”‚  ğŸ” THREAT 3: Fake Device or Unauthorized Attendance Post                                          â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚     SOLUTION: Session Token (JWT) + Device ID verification                                        â”‚
â”‚     â€¢ Server generates unique session_token for each lecture                                       â”‚
â”‚     â€¢ Expires after lecture duration                                                               â”‚
â”‚     â€¢ Device must include token + device_id in sync request                                        â”‚
â”‚     â€¢ Backend verifies token authenticity + matches device                                         â”‚
â”‚     â€¢ Old/replayed tokens rejected                                                                 â”‚
â”‚                                                                                                      â”‚
â”‚  ğŸ” THREAT 4: Offline Attendance Spoofing                                                          â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚     SOLUTION: Cached session validation + Server-side re-verification                              â”‚
â”‚     â€¢ Session data (token + allowed_rolls) cached in ESP32 SPIFFS                                  â”‚
â”‚     â€¢ Offline scans validated against cached data                                                  â”‚
â”‚     â€¢ When online, re-verified against server database                                             â”‚
â”‚     â€¢ Duplicate prevention at sync time                                                            â”‚
â”‚                                                                                                      â”‚
â”‚  ğŸ” THREAT 5: Network-Level Attacks (MITM)                                                        â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚     SOLUTION: HTTPS + JWT signature verification                                                  â”‚
â”‚     â€¢ All API calls over HTTPS/TLS                                                                â”‚
â”‚     â€¢ JWT tokens signed with Supabase secret key                                                  â”‚
â”‚     â€¢ Device stores public key for offline verification                                            â”‚
â”‚     â€¢ Prevents tampering of session_token in transit                                              â”‚
â”‚                                                                                                      â”‚
â”‚  ğŸ” THREAT 6: Session Token Reuse                                                                 â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚     SOLUTION: Token expiry + session_id binding                                                   â”‚
â”‚     â€¢ Each session_token includes exp claim                                                        â”‚
â”‚     â€¢ Token valid only for that specific session_id                                                â”‚
â”‚     â€¢ Marks as COMPLETED after session ends                                                        â”‚
â”‚     â€¢ Old tokens automatically rejected                                                            â”‚
â”‚                                                                                                      â”‚
â”‚  ğŸ” THREAT 7: Database Record Tampering                                                            â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚     SOLUTION: Row-level security (RLS) + Audit logs                                                â”‚
â”‚     â€¢ PostgreSQL RLS policies on attendance tables                                                 â”‚
â”‚     â€¢ Only Supabase functions can INSERT records                                                  â”‚
â”‚     â€¢ Admin cannot directly modify attendance                                                      â”‚
â”‚     â€¢ Activity logs track all modifications                                                        â”‚
â”‚                                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Role-Based Access Control (RBAC)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         RBAC PERMISSIONS                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                      â”‚
â”‚   STUDENT ROLE:                                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                                     â”‚
â”‚   âœ“ View own attendance records                                                                     â”‚
â”‚   âœ“ View own enrollment status                                                                      â”‚
â”‚   âœ— Cannot start session                                                                            â”‚
â”‚   âœ— Cannot modify attendance                                                                        â”‚
â”‚   âœ— Cannot access other students' data                                                              â”‚
â”‚                                                                                                      â”‚
â”‚   FACULTY ROLE:                                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                                    â”‚
â”‚   âœ“ Start lecture session                                                                           â”‚
â”‚   âœ“ End lecture session                                                                             â”‚
â”‚   âœ“ View attendance for their classes                                                               â”‚
â”‚   âœ“ Mark manual attendance (override)                                                               â”‚
â”‚   âœ“ Download attendance reports                                                                     â”‚
â”‚   âœ— Cannot edit other faculty's sessions                                                            â”‚
â”‚   âœ— Cannot access other departments' data                                                           â”‚
â”‚                                                                                                      â”‚
â”‚   ADMIN ROLE:                                                                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                                       â”‚
â”‚   âœ“ Create/manage devices                                                                           â”‚
â”‚   âœ“ View all attendance records                                                                     â”‚
â”‚   âœ“ Modify attendance (with audit log)                                                              â”‚
â”‚   âœ“ Generate system reports                                                                         â”‚
â”‚   âœ“ Manage user roles                                                                               â”‚
â”‚   âœ“ Configure system settings                                                                       â”‚
â”‚                                                                                                      â”‚
â”‚   DEVICE ROLE (ESP32):                                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                                â”‚
â”‚   âœ“ Read session_token (when provided)                                                              â”‚
â”‚   âœ“ POST attendance records                                                                         â”‚
â”‚   âœ“ GET student list for batch                                                                      â”‚
â”‚   âœ— Cannot modify any data                                                                          â”‚
â”‚   âœ— Cannot delete records                                                                           â”‚
â”‚                                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
