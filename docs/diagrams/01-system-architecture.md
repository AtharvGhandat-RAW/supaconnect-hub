# Attendro System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      ATTENDRO SYSTEM ARCHITECTURE                                    │
│                    Teacher-Unlocked, Subject-Wise Biometric Attendance System                       │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                         FACULTY LAYER                                                 │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                       │
│    ┌─────────────────────────────────────┐      ┌─────────────────────────────────────┐              │
│    │       FACULTY MOBILE APP            │      │       FACULTY WEB APP               │              │
│    │    ┌───────────────────────────┐    │      │    ┌───────────────────────────┐    │              │
│    │    │  📱 Start Lecture Session │    │      │    │  💻 Session Management    │    │              │
│    │    │  📋 Select Subject        │    │      │    │  📊 Live Attendance View  │    │              │
│    │    │  👥 Select Class/Batch    │    │      │    │  📈 Reports & Analytics   │    │              │
│    │    │  ⏰ Set Duration          │    │      │    │  ⚙️  Settings             │    │              │
│    │    │  🔐 Generate Session Token│    │      │    │  📝 Session History       │    │              │
│    │    └───────────────────────────┘    │      │    └───────────────────────────┘    │              │
│    └─────────────────────────────────────┘      └─────────────────────────────────────┘              │
│                         │                                        │                                    │
│                         └────────────────┬───────────────────────┘                                    │
│                                          ▼                                                            │
└──────────────────────────────────────────┼───────────────────────────────────────────────────────────┘
                                           │ HTTPS/REST API
┌──────────────────────────────────────────┼───────────────────────────────────────────────────────────┐
│                                   CLOUD BACKEND LAYER                                                │
├──────────────────────────────────────────┼───────────────────────────────────────────────────────────┤
│                                          ▼                                                           │
│    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐   │
│    │                              SUPABASE BACKEND                                                │   │
│    │  ┌────────────────────────────────────────────────────────────────────────────────────────┐ │   │
│    │  │                            EDGE FUNCTIONS (APIs)                                        │ │   │
│    │  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  ┌────────────────┐  │ │   │
│    │  │  │  create-session  │  │  verify-token    │  │  sync-attendance │  │  get-students  │  │ │   │
│    │  │  │  ───────────────  │  │  ─────────────   │  │  ───────────────  │  │  ─────────────  │  │ │   │
│    │  │  │  • Generate Token │  │  • Validate JWT  │  │  • Batch Insert  │  │  • By Class    │  │ │   │
│    │  │  │  • Set Batch Lock │  │  • Check Expiry  │  │  • Conflict Res  │  │  • By Batch    │  │ │   │
│    │  │  │  • Time Window    │  │  • Device Auth   │  │  • Offline Merge │  │  • Roll List   │  │ │   │
│    │  │  └──────────────────┘  └──────────────────┘  └──────────────────┘  └────────────────┘  │ │   │
│    │  └────────────────────────────────────────────────────────────────────────────────────────┘ │   │
│    │                                          │                                                   │   │
│    │  ┌────────────────────────────────────────────────────────────────────────────────────────┐ │   │
│    │  │                              POSTGRESQL DATABASE                                        │ │   │
│    │  │                                                                                         │ │   │
│    │  │  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────────┐  ┌──────────────────┐  │ │   │
│    │  │  │    students     │  │    subjects     │  │ biometric_sessions│  │biometric_records │  │ │   │
│    │  │  │  ─────────────  │  │  ─────────────  │  │  ───────────────  │  │ ───────────────   │  │ │   │
│    │  │  │  • roll_no      │  │  • subject_code │  │  • session_token │  │  • roll_no       │  │ │   │
│    │  │  │  • fingerprint_id│  │  • name        │  │  • device_id     │  │  • session_id    │  │ │   │
│    │  │  │  • class_id     │  │  • type (TH/PR) │  │  • allowed_rolls │  │  • timestamp     │  │ │   │
│    │  │  │  • batch        │  │  • semester     │  │  • batch_lock    │  │  • sync_status   │  │ │   │
│    │  │  └─────────────────┘  └─────────────────┘  └──────────────────┘  └──────────────────┘  │ │   │
│    │  │                                                                                         │ │   │
│    │  │  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────────┐  ┌──────────────────┐  │ │   │
│    │  │  │    classes      │  │    faculty      │  │   esp32_devices  │  │  offline_queue   │  │ │   │
│    │  │  │  ─────────────  │  │  ─────────────  │  │  ───────────────  │  │ ───────────────   │  │ │   │
│    │  │  │  • division     │  │  • profile_id   │  │  • device_id     │  │  • record_data   │  │ │   │
│    │  │  │  • year         │  │  • department   │  │  • location      │  │  • created_at    │  │ │   │
│    │  │  │  • semester     │  │  • emp_code     │  │  • status        │  │  • synced_at     │  │ │   │
│    │  │  └─────────────────┘  └─────────────────┘  └──────────────────┘  └──────────────────┘  │ │   │
│    │  └────────────────────────────────────────────────────────────────────────────────────────┘ │   │
│    │                                                                                              │   │
│    │  ┌────────────────────────────────────────────────────────────────────────────────────────┐ │   │
│    │  │                              REALTIME SUBSCRIPTIONS                                     │ │   │
│    │  │        WebSocket channels for live attendance updates to dashboard                      │ │   │
│    │  └────────────────────────────────────────────────────────────────────────────────────────┘ │   │
│    └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                          │                                                           │
└──────────────────────────────────────────┼───────────────────────────────────────────────────────────┘
                                           │ HTTPS/REST + WebSocket
                                           ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      IOT DEVICE LAYER                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                       │
│    ┌─────────────────────────────────────────────────────────────────────────────────────────────┐   │
│    │                              ESP32 BIOMETRIC DEVICE                                          │   │
│    │                                                                                              │   │
│    │  ┌─────────────────────────────────────────────────────────────────────────────────────┐    │   │
│    │  │                              HARDWARE COMPONENTS                                      │    │   │
│    │  │                                                                                       │    │   │
│    │  │   ┌─────────────────────┐    ┌─────────────────────┐    ┌─────────────────────┐     │    │   │
│    │  │   │   ESP32 DevKit V1   │    │  R307 Fingerprint   │    │  0.93" OLED SPI     │     │    │   │
│    │  │   │   ─────────────────  │    │  Sensor             │    │  Display            │     │    │   │
│    │  │   │   • Wi-Fi Module    │    │  ─────────────────   │    │  ─────────────────   │     │    │   │
│    │  │   │   • Dual Core CPU   │◄──►│  • 120 ID Storage   │    │  • 128x64 pixels    │     │    │   │
│    │  │   │   • 520KB SRAM      │    │  • UART Interface   │    │  • SPI Interface    │     │    │   │
│    │  │   │   • Flash Storage   │    │  • FAR < 0.001%     │    │  • Status Display   │     │    │   │
│    │  │   │   • GPIO Pins       │────►│  • FRR < 0.1%       │    │  • User Feedback    │     │    │   │
│    │  │   └─────────────────────┘    └─────────────────────┘    └─────────────────────┘     │    │   │
│    │  │              │                                                    ▲                  │    │   │
│    │  │              └────────────────────────────────────────────────────┘                  │    │   │
│    │  │                              SPI Communication                                        │    │   │
│    │  └─────────────────────────────────────────────────────────────────────────────────────┘    │   │
│    │                                                                                              │   │
│    │  ┌─────────────────────────────────────────────────────────────────────────────────────┐    │   │
│    │  │                              SOFTWARE MODULES                                         │    │   │
│    │  │                                                                                       │    │   │
│    │  │   ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐   ┌─────────────┐  │    │   │
│    │  │   │ Session Manager │   │ Fingerprint     │   │ Offline Queue   │   │ Display     │  │    │   │
│    │  │   │ ─────────────── │   │ Handler         │   │ Manager         │   │ Controller  │  │    │   │
│    │  │   │ • Token Verify  │   │ ─────────────── │   │ ─────────────── │   │ ─────────── │  │    │   │
│    │  │   │ • Roll List     │   │ • Scan & Match  │   │ • Store Local   │   │ • Show State│  │    │   │
│    │  │   │ • Time Check    │   │ • ID Extraction │   │ • Auto Sync     │   │ • Show Roll │  │    │   │
│    │  │   │ • Batch Filter  │   │ • Validation    │   │ • Conflict Res  │   │ • Errors    │  │    │   │
│    │  │   └─────────────────┘   └─────────────────┘   └─────────────────┘   └─────────────┘  │    │   │
│    │  └─────────────────────────────────────────────────────────────────────────────────────┘    │   │
│    └─────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      DATA FLOW LEGEND                                                │
├──────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                       │
│    ────────►  HTTP/HTTPS Request           ════════►  WebSocket/Realtime                            │
│    ◄────────  HTTP/HTTPS Response          ◄════════  Subscription Updates                          │
│    ─ ─ ─ ─►  Offline Queue Sync            ▬▬▬▬▬▬▬►  Hardware Interface                             │
│                                                                                                       │
│    🔐 Session Token Flow:  Faculty App → Supabase → ESP32 Device                                    │
│    👆 Fingerprint Flow:    R307 Sensor → ESP32 → Supabase (or Local Queue)                          │
│    📊 Realtime Updates:    Supabase → Dashboard (WebSocket)                                         │
│                                                                                                       │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Architecture Components Description

### 1. Faculty Layer
- **Faculty Mobile App**: React Native/Flutter app for teachers to start lecture sessions
- **Faculty Web App**: React-based web dashboard for session management and reports

### 2. Cloud Backend Layer (Supabase)
- **Edge Functions**: Serverless functions for API endpoints
- **PostgreSQL Database**: Main data storage with attendance records
- **Realtime Subscriptions**: WebSocket-based live updates

### 3. IoT Device Layer
- **ESP32 DevKit**: Main microcontroller with Wi-Fi
- **R307 Fingerprint Sensor**: Biometric capture and matching
- **OLED Display**: User feedback and status display
